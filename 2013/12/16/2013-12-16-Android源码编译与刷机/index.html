<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="randerer" content="webkit"><meta http-equiv="Cache-Control" content="no-siteapp"><meta http-equiv="Cache-Control" content="no-transform"><title>Android源码编译与刷机 | 在家网赚</title><link rel="stylesheet" href="/css/normailze.css"><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"></head><body><!--[if ltg IE 9]><div>是时候换个现代浏览器了，点击更换<a href="http://browsehappy.com/"></a></div><!--<![endif]--><header><!--include nav--></header><section class="content"><article class="content__post"><h1 class="post__title">Android源码编译与刷机</h1><div class="post__date">2013-12-16</div><section><ul>
<li>content<br>{:toc}</li>
</ul>
<h2 id="源码编译"><a href="#源码编译" class="headerlink" title="源码编译"></a>源码编译</h2><h3 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h3><p><a href="source.android.com">source.android.com</a></p>
<h3 id="下载驱动"><a href="#下载驱动" class="headerlink" title="下载驱动"></a>下载驱动</h3><ol>
<li><a href="https://developers.google.com/android/nexus/drivers" target="_blank" rel="noopener">https://developers.google.com/android/nexus/drivers</a> 下载所需对应的机型的驱动二进制文件</li>
<li>将下载好的驱动文件解压到源码根目录下。</li>
<li>sh 文件名.sh 进行安装。</li>
</ol>
<h3 id="编译源码"><a href="#编译源码" class="headerlink" title="编译源码"></a>编译源码</h3><ol>
<li>设置编译环境：$ source build/envsetup.sh</li>
<li>选择编译对应的机型：$ lunch<br>代号对应的机型在下驱动文件时就能看到，例如 Nexus 4对应的代号就是mako，如果要编译该机型系统，选择11即可。</li>
<li>编译系统：</li>
</ol>
<ul>
<li>make –jn，n代表线程数，根据自己电脑的情况选择，一般双核CPU选择4个线程编译；该命令输出img格式的系统刷机文件。</li>
<li>make -jn otapackage该命令生成更加通用的zip格式，更加通用，比如第三方的recovery也能使用。</li>
</ul>
<ol start="4">
<li>编译完成后，刷机文件一律生成于源码根目录/out/target/product/对应的设备代号</li>
</ol>
<h3 id="刷机"><a href="#刷机" class="headerlink" title="刷机"></a>刷机</h3><ol>
<li>编译fastboot和adb工具：<br>$ make fastboot adb</li>
<li>手机进入fastboot模式，一般是关机后，按住音量键减+电源键进入。</li>
<li>输入命令，查看设备是否被识别：./out/host/linux-x86/bin/fastboot devices</li>
<li>解锁设备：$ fastboot oem unlock</li>
<li>刷入ROM：</li>
</ol>
<ul>
<li>一次全部刷入，如下:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot flashall -w</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>一般情况下这一步会出现以下错误提示：neither -p product specified nor ANDROID_PRODUCT_OUT set；<br>原因是没有设置rom的位置，解决方法要么使用-p参数，后面跟着rom的位置；<br>或者配置环境变量ANDROID_PRODUCT_OUT，过程如下：<br>输入sudo gedit /etc/profile，在尾部添加export ANDROID_PRODUCT_OUT=源码目录/out/target/product/设备代号，保存并退出<br>然后输入source /etc/profile使刚设置的环境变量立即生效。</p>
<ul>
<li>单独刷boot,recovery,system三个img文件，如下:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ./fastboot flash bootloader /out/target/product/mako/boot.img</span><br><span class="line">$sudo ./fastboot reboot-bootloader</span><br><span class="line">$ sudo ./fastboot flash recovery out/target/product/mako/recovery.img</span><br><span class="line">$sudo ./fastboot reboot-bootloader</span><br><span class="line">$ sudo ./fastboot flash system -w out/target/product/mako/system.img</span><br></pre></td></tr></table></figure></li>
</ul>
</section></article></section><section class="comment"><div class="ds-thread" data-thread-key="2013/12/16/2013-12-16-Android源码编译与刷机/" data-title="Android源码编译与刷机" data-url="http://zaijiangwangzhuan.com/2013/12/16/2013-12-16-Android源码编译与刷机/"></div><script>var duoshuoQuery = {short_name:'chordblog'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
})()</script></section><footer></footer><!--include copyright--></body></html>